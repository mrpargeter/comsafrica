print(comsafrica_techtechthickprox)
set.seed(50)
comsafrica_techtechthickprox<-rpt(techthickprox ~ new_flake_id*analysis_order + (1 | new_flake_id),
grname = c("new_flake_id","Fixed"),
data = tech_thick_prox_data,
datatype = "Gaussian",
nboot = 1000, npermut = 100)
print(comsafrica_techtechthickprox)
set.seed(50)
comsafrica_techtechthickprox<-rpt(techthickprox ~ new_flake_id*analysis_order + (1 | new_flake_id),
grname = c("new_flake_id","Fixed"),
data = comsafrica_data_complete,
datatype = "Gaussian",
nboot = 1000, npermut = 100)
View(comsafrica_data_complete)
comsafrica_data_complete<-new_comsafrica_data %>%
select(c(assemblage_code,analyst_id,analysis_order,flake_id,new_flake_id,proximal_scars,left_scars,distal_scars,right_scars,
dorsal_cortex,mass,maximumdimension,maximumwidth,maximumthickness,techlength,techmaxwidth,techmaxthickness,
techwidthprox,techwidthmes,techwidthdist,techthickprox,techthickmes,techthickdist,
platfwidth,platfthickimpact,platfthickmid,platfthickmax,edgeplatf,angle_height))
comsafrica_angle_height<-rpt(angle_height ~ new_flake_id*analysis_order + (1 | new_flake_id),
grname = c("new_flake_id","Fixed"),
data = comsafrica_data_complete,
datatype = "Gaussian",
nboot = 1000, npermut = 100)
comsafrica_data<-read.csv("comsafrica_complete_adjusted.csv") %>%
subset(!flake_id == "NONR3495") #filter out this non numbered flake
# change column names to lower case
colnames(comsafrica_data) <- tolower(colnames(comsafrica_data))
data.A <- comsafrica_data[which(comsafrica_data$assemblage_code=="chert_condition_A"),]
data.A$new_flake_id <- 0
for(i in 1:length(unique(data.A$flake_id))){
data.A[which(data.A$flake_id==unique(data.A$flake_id)[i]),"new_flake_id"] <- i
}
data.B <- comsafrica_data[which(comsafrica_data$assemblage_code=="chert_condition_B"),]
count = 51
data.B$new_flake_id <- 0
for(i in 1:length(unique(data.B$flake_id))){
data.B[which(data.B$flake_id==unique(data.B$flake_id)[i]),"new_flake_id"] <- count
count = count+1
}
new_comsafrica_data <- rbind(data.A, data.B)
comsafrica_data_complete<-new_comsafrica_data %>%
select(c(assemblage_code,analyst_id,analysis_order,flake_id,new_flake_id,proximal_scars,left_scars,distal_scars,right_scars,
dorsal_cortex,mass,maximumdimension,maximumwidth,maximumthickness,techlength,techmaxwidth,techmaxthickness,
techwidthprox,techwidthmes,techwidthdist,techthickprox,techthickmes,techthickdist,
platfwidth,platfthickimpact,platfthickmid,platfthickmax,edgeplatf,angle_height))
#angle height
set.seed(50)
comsafrica_angle_height<-rpt(angle_height ~ new_flake_id*analysis_order + (1 | new_flake_id),
grname = c("new_flake_id","Fixed"),
data = comsafrica_data_complete,
datatype = "Gaussian",
nboot = 1000, npermut = 100)
print(comsafrica_angle_height)
summary(comsafrica_angle_height)
comsafrica_data<-read.csv("comsafrica_complete_adjusted.csv",stringsAsFactors=TRUE) %>%
subset(!flake_id == "NONR3495") #filter out this non numbered flake
detachAllPackages <- function() {
basic.packages <- c("package:stats","package:graphics","package:grDevices","package:utils","package:datasets","package:methods","package:base")
package.list <- search()[ifelse(unlist(gregexpr("package:",search()))==1,TRUE,FALSE)]
package.list <- setdiff(package.list,basic.packages)
if (length(package.list)>0)  for (package in package.list) detach(package, character.only=TRUE)
}
detachAllPackages()
# Create package list to check for installed packages
library(dplyr)
library(rptR)
library(krippendorffsalpha)
library(tidyverse)
library(irr)
library(EnvStats)
library(naniar)
library(irrCAC)
library(stringr)
library(ggrepel)
comsafrica_data<-read.csv("comsafrica_complete_adjusted.csv",stringsAsFactors=TRUE) %>%
subset(!flake_id == "NONR3495") #filter out this non numbered flake
# change column names to lower case
colnames(comsafrica_data) <- tolower(colnames(comsafrica_data))
## clean categorical variables
comsafrica_data<-comsafrica_data %>%
mutate(completeness=recode(completeness,
fragment="Indeterminate",
shatter="Indeterminate",
lateral="Indeterminate",
indeterminate="Indeterminate",
Indet="Indeterminate",
other="Indeterminate"),
red_syst=recode(red_syst,Discoidal = "Discoid",idnet = "Indet",inde = "Indet",
Indeterminate = "Indet",other = "Indet",Ind = "Indet",
indet = "Indet",Indet = "Indet",INDET = "Indet",'indeterminate (broken)' = "Indet",
'Indeterminate (broken)' = "Indet",indeterminate = "Indet",laminar = "Laminar",
'Levallois (pref)' = "Levallois",'Lev or Disc' = "Indet",'Levallois indet' = "Levallois",
'Levallois non-Nubian' = "Levallois",'levallois non nubian' = "Levallois",
'LEVALLOIS OR DISCOID' = "Levallois",'LEVALLOIS/LEVALLOIS-RELATED' = "Levallois",
na = "Indet",'NON-LEVALLOIS; ORTHOGONAL VOLUME EXPLOITATION' = "Indet",
none = "Indet",Nubian = "Levallois",'ON ANVIL' = "Bipolar",
'Platform (laminar?)' = "Platform",'Platform / Laminar' = "Platform",
'possible Levallois non-Nubian' = "Levallois",'Other (informal)' = "Indet",
'potential levallois' = "Levallois",levallois = "Levallois",
LEVALLOIS = "Levallois",'Levallois non Nubian' = "Levallois",'Levallois?' = "Levallois",
'potential Lev' = "Levallois",'potential Levallois' = "Levallois",
CENTRIPETAL = "Discoid",discoid = "Discoid",DISCOID = "Discoid",
'Discoid?' = "Discoid",'Core Edge Flake' = "Indet",FLAKE = "Flake",bipolar = "Bipolar"),
red_syst=na_if(red_syst, "Indet"),                                                                    #replace indet by NAs
platform_cortex=recode(platform_cortex, INDET = "Indeterminate",
complete = "Complete", absent = "Absent"),
platform_cortex=na_if(platform_cortex, "Indeterminate"),
flk_form=recode(flk_form,BLADE = "Blade",CONVFLAKE = "Convflake",ELONG = "Blade",
Elong = "Blade",flake = "Flake",FLAKE = "Flake",INDET="Indeterminate"),
flk_form=na_if(flk_form, "Indeterminate"),
directionality=recode(directionality,centripetal = "Centripetal",other = "Other"),
platfmorph=recode(platfmorph,'Chapeau de Gendarme' = "ChapeauDeGendarme",linear = "Linear",
Diherdral = "Dihedral",facetted = "Facetted"),
platflipp=recode_factor(platflipp, YES = "yes", Yes='yes',NO = "no", No="no", 'NOT APPLICABLE' = "Indeterminate"),
platflipp=na_if(platflipp, "Indeterminate"),
bulb=recode(bulb, YES = "yes", Yes="yes",NO = "no",No="no",Indet="Indeterminate"),
bulb=na_if(bulb, "Indeterminate"),
shattbulb=recode(shattbulb,Indet = "Indeterminate",Indeterminateerminate = "Indeterminate",
NO = "No",no="No",YES = "Yes"),
initiation=recode(initiation,BENDING = "Bending",HERTZIAN = "Hertzian",hertzian = "Hertzian",
WEDGING = "Wedging"),
initiation=na_if(initiation, "INDET"),
ventr_plane_form=recode(ventr_plane_form,very_concave = "Very concave",Very_concave = "Very concave",
BULBAR = "Bulbar",CONCAVE = "Concave",FLAT = "Flat",
TWISTED = "Twisted",'VERY CONCAVE' = "Very concave",VERY_CONCAVE = "Very concave"),
section=recode(section,DOMED = "Domed",INDET = "Indeterminate",LENTIC = "Lenticular",
LENTICULAR = "Lenticular",RIGHTTRI = "Righttriangle",RIGHTTRIANGLE = "Righttriangle",FLAT="Lenticular",
TRAP = "Trapezoidal",TRAPEZOIDAL = "Trapezoidal",TRI = "Triangular",TRIANGULAR = "Triangular"),
section=na_if(section, "Indeterminate"),
latedgetype=recode(latedgetype,AMORPH = "Amorphous",CONV = "Convergent",CONVERGENT = "Convergent",SQUARE = "Square",
'SUB-PARALLEL' = "Parallel",DIAMOND = "Diamond",DIV = "Divergent",DIVERGENT = "Divergent",
OVAL = "Ovoid",OVOID = "Ovoid",PARALLEL = "Parallel", INDET = "Indeterminate"),
latedgetype=na_if(latedgetype, "na"),
latedgetype=na_if(latedgetype, "Indeterminate"),
flaketerm=recode(flaketerm,FEATHER = "Feather",HINGE = "Hinge",INDET = "Indeterminate",
OVERSHOT = "Overshot",AXIAL= "Axial",CRUSHED = "Crushed"),
flaketerm=na_if(flaketerm, "Indeterminate"),
kombewa=recode(kombewa,NO = "No",YES = "Yes",no="No", Indet="Indeterminate"),
distplanform=recode(distplanform,FLAT = "Flat",INDET = "Indeterminate",INDETERMINATE = "Indeterminate",CONCAVE="Indeterminate",
IRR = "Irregular",Irreg = "Irregular",POINTED = "Pointed",rounded = "Rounded",ROUNDED = "Rounded"),
distplanform=na_if(distplanform, "Indeterminate"))%>%
map_df(~ na_if(.x, "")) %>%
droplevels
#replacement of NA values by 'Indeterminate' for specific variables where NAs = indet
comsafrica_data$completeness <- fct_explicit_na(comsafrica_data$completeness, na_level = "Indeterminate")
comsafrica_data$kombewa <- fct_explicit_na(comsafrica_data$kombewa, na_level = "Indeterminate")
summary(comsafrica_data$completeness)# I grouped together other and indeterminate too as it seems that analysts
#used one or the other, but rarely both
summary(comsafrica_data$red_syst)
summary(comsafrica_data$platform_cortex) #indet used for distal fragments as well (as na), so grouped with NAs
summary(comsafrica_data$flk_form) #indet removed, not an option in the E4 file
summary(comsafrica_data$directionality) #indet and other kept as used by same analysts. NAs correspond to when it was not possible to record data (100% cortex) and some human errors
summary(comsafrica_data$platfmorph) #other and indet used by same analysts. Nas correspond to mostly fragments and a few human errors
summary(comsafrica_data$platflipp) #indet exclusively produced by E4 users while NAs correspond to fragments as well as likely indet from non-E4 users (as they are associated with
#a determined platf) --> indet to be removed from the analysis.
summary(comsafrica_data$bulb) #indet are also present when medial fragment so indet is also used as NAs. removed from analysis
summary(comsafrica_data$initiation) #only one INDET, removed from the analysis --> NA
summary(comsafrica_data$ventr_plane_form)
summary(comsafrica_data$section) #flat doesn't exist in E4, grouped with Lenticular; indeterminate can be NA or indet, so replaced by NA
summary(comsafrica_data$latedgetype) #indet is mostly na with a few true indet, so replaced by NA
summary(comsafrica_data$flaketerm) #indet can be both na and indet, so replaced by NA
summary(comsafrica_data$kombewa) #indet are indet and nas are indet with maybe few NAs, I think we can replace NAs by indet.
summary(comsafrica_data$distplanform) #concave does not exist --> indeterminate; indet seems to correspond to NAs (prox or medial fragments?) so grouped with NAs
## cleaning quantitative data##
summary(comsafrica_data$dorsal_cortex)
summary(comsafrica_data$maximumdimension)
comsafrica_data$maximumdimension[comsafrica_data$maximumdimension==0] <- NA
summary(comsafrica_data$mass)
comsafrica_data$mass[comsafrica_data$mass==0] <- NA
summary(comsafrica_data$maximumwidth)
comsafrica_data$maximumwidth[comsafrica_data$maximumwidth==0] <- NA
summary(comsafrica_data$maximumthickness)
comsafrica_data$maximumthickness[comsafrica_data$maximumthickness==0] <- NA
summary(comsafrica_data$techlength)
comsafrica_data$techlength[comsafrica_data$techlength==0] <- NA
summary(comsafrica_data$techmaxwidth)
comsafrica_data$techmaxwidth[comsafrica_data$techmaxwidth==0] <- NA
summary(comsafrica_data$techmaxthickness)
comsafrica_data$techmaxthickness[comsafrica_data$techmaxthickness==0] <- NA
summary(comsafrica_data$techwidthprox)
comsafrica_data$techwidthprox[comsafrica_data$techwidthprox==0] <- NA
summary(comsafrica_data$techwidthmes)
comsafrica_data$techwidthmes[comsafrica_data$techwidthmes==0] <- NA
summary(comsafrica_data$techwidthdist)
comsafrica_data$techwidthdist[comsafrica_data$techwidthdist==0] <- NA
summary(comsafrica_data$techthickprox)
comsafrica_data$techthickprox[comsafrica_data$techthickprox==0] <- NA
summary(comsafrica_data$techthickmes)
comsafrica_data$techthickmes[comsafrica_data$techthickmes==0] <- NA
summary(comsafrica_data$techthickdist)
comsafrica_data$techthickdist[comsafrica_data$techthickdist==0] <- NA
summary(comsafrica_data$platfwidth)
comsafrica_data$platfwidth[comsafrica_data$platfwidth==0] <- NA
summary(comsafrica_data$platfthickmax)
comsafrica_data$platfthickmax[comsafrica_data$platfthickmax==0] <- NA
summary(comsafrica_data$platfthickimpact)
comsafrica_data$platfthickimpact[comsafrica_data$platfthickimpact==0] <- NA
summary(comsafrica_data$platfthickmid)
comsafrica_data$platfthickmid[comsafrica_data$platfthickmid==0] <- NA
summary(comsafrica_data$edgeplatf)
comsafrica_data$edgeplatf[comsafrica_data$edgeplatf==0] <- NA
data.A <- comsafrica_data[which(comsafrica_data$assemblage_code=="chert_condition_A"),]
data.A$new_flake_id <- 0
for(i in 1:length(unique(data.A$flake_id))){
data.A[which(data.A$flake_id==unique(data.A$flake_id)[i]),"new_flake_id"] <- i
}
data.B <- comsafrica_data[which(comsafrica_data$assemblage_code=="chert_condition_B"),]
count = 51
data.B$new_flake_id <- 0
for(i in 1:length(unique(data.B$flake_id))){
data.B[which(data.B$flake_id==unique(data.B$flake_id)[i]),"new_flake_id"] <- count
count = count+1
}
new_comsafrica_data <- rbind(data.A, data.B) %>%
filter(!new_flake_id %in% c(89,97)) #remove two flakes with fragmentation issues
comsafrica_data_complete<-new_comsafrica_data %>%
select(c(assemblage_code,analyst_id,analysis_order,flake_id,new_flake_id,proximal_scars,left_scars,distal_scars,right_scars,
dorsal_cortex,mass,maximumdimension,maximumwidth,maximumthickness,techlength,techmaxwidth,techmaxthickness,
techwidthprox,techwidthmes,techwidthdist,techthickprox,techthickmes,techthickdist,
platfwidth,platfthickimpact,platfthickmid,platfthickmax,edgeplatf,angle_height))
comsafrica_data_complete$dorsal_cortex[comsafrica_data_complete$new_flake_id == 46
& comsafrica_data_complete$analyst_id == "46b96"] <- 100
comsafrica_data_complete$dorsal_cortex[comsafrica_data_complete$new_flake_id == 31
& comsafrica_data_complete$analyst_id == "46b96"] <- NA
new_comsafrica_data$dorsal_cortex[new_comsafrica_data$new_flake_id == 23
& new_comsafrica_data$analyst_id == "46b96"] <- 100
comsafrica_data_complete$maximumthickness[comsafrica_data_complete$new_flake_id == 11
& comsafrica_data_complete$analyst_id == "r42o8"] <- 17.59
comsafrica_data_complete$techlength[comsafrica_data_complete$new_flake_id == 11
& comsafrica_data_complete$analyst_id == "r42o8"] <- 83.46
comsafrica_data_complete$techmaxwidth[comsafrica_data_complete$new_flake_id == 11
& comsafrica_data_complete$analyst_id == "r42o8"] <- 48
comsafrica_data_complete$techmaxthickness[comsafrica_data_complete$new_flake_id == 11
& comsafrica_data_complete$analyst_id == "r42o8"] <- 12.77
comsafrica_data_complete$techwidthprox[comsafrica_data_complete$new_flake_id == 11
& comsafrica_data_complete$analyst_id == "r42o8"] <- NA
comsafrica_data_complete$techwidthmes[comsafrica_data_complete$new_flake_id == 11
& comsafrica_data_complete$analyst_id == "r42o8"] <- NA
comsafrica_data_complete$techwidthdist[comsafrica_data_complete$new_flake_id == 11
& comsafrica_data_complete$analyst_id == "r42o8"] <- NA
comsafrica_data_complete$maximumwidth[comsafrica_data_complete$new_flake_id == 40
& comsafrica_data_complete$analyst_id == "r42o8"] <- 27.05
comsafrica_data_complete$maximumthickness[comsafrica_data_complete$new_flake_id == 40
& comsafrica_data_complete$analyst_id == "r42o8"] <- 7.69
comsafrica_data_complete$techlength[comsafrica_data_complete$new_flake_id == 40
& comsafrica_data_complete$analyst_id == "r42o8"] <- 50.42
comsafrica_data_complete$techmaxwidth[comsafrica_data_complete$new_flake_id == 40
& comsafrica_data_complete$analyst_id == "r42o8"] <- NA
comsafrica_data_complete$maximumwidth[comsafrica_data_complete$new_flake_id == 85
& comsafrica_data_complete$analyst_id == "r42o8"] <- 55.01
comsafrica_data_complete$maximumthickness[comsafrica_data_complete$new_flake_id == 83
& comsafrica_data_complete$analyst_id == "r42o8"] <- 12.59
comsafrica_data_complete$techlength[comsafrica_data_complete$new_flake_id == 83
& comsafrica_data_complete$analyst_id == "r42o8"] <- 51.39
comsafrica_data_complete$techmaxwidth[comsafrica_data_complete$new_flake_id == 83
& comsafrica_data_complete$analyst_id == "r42o8"] <- NA
comsafrica_data_complete$maximumwidth[comsafrica_data_complete$new_flake_id == 85
& comsafrica_data_complete$analyst_id == "r42o8"] <- 19.93
comsafrica_data_complete$maximumthickness[comsafrica_data_complete$new_flake_id == 85
& comsafrica_data_complete$analyst_id == "r42o8"] <- NA
comsafrica_data_complete$techwidthprox[comsafrica_data_complete$new_flake_id == 41
& comsafrica_data_complete$analyst_id == "r42o8"] <- NA
comsafrica_data_complete$techwidthdist[comsafrica_data_complete$new_flake_id == 70
& comsafrica_data_complete$analyst_id == "r42o8"] <- 38.53
comsafrica_data_complete$techthickprox[comsafrica_data_complete$new_flake_id == 70
& comsafrica_data_complete$analyst_id == "r42o8"] <- 16.75
comsafrica_data_complete$techthickmes[comsafrica_data_complete$new_flake_id == 70
& comsafrica_data_complete$analyst_id == "r42o8"] <- 12.55
comsafrica_data_complete$techthickdist[comsafrica_data_complete$new_flake_id == 70
& comsafrica_data_complete$analyst_id == "r42o8"] <- NA
comsafrica_data_complete$techwidthmes[comsafrica_data_complete$new_flake_id == 33
& comsafrica_data_complete$analyst_id == "r42o8"] <- 41.17
comsafrica_data_complete$techwidthdist[comsafrica_data_complete$new_flake_id == 33
& comsafrica_data_complete$analyst_id == "r42o8"] <- 26.43
comsafrica_data_complete$techthickprox[comsafrica_data_complete$new_flake_id == 33
& comsafrica_data_complete$analyst_id == "r42o8"] <- 9.09
comsafrica_data_complete$techthickmes[comsafrica_data_complete$new_flake_id == 33
& comsafrica_data_complete$analyst_id == "r42o8"] <- 7.77
comsafrica_data_complete$techthickdist[comsafrica_data_complete$new_flake_id == 33
& comsafrica_data_complete$analyst_id == "r42o8"] <- 5.34
comsafrica_data_complete$platfwidth[comsafrica_data_complete$new_flake_id == 33
& comsafrica_data_complete$analyst_id == "r42o8"] <- NA
comsafrica_data_complete<-new_comsafrica_data %>%
select(c(assemblage_code,analyst_id,analysis_order,flake_id,new_flake_id,proximal_scars,left_scars,distal_scars,right_scars,
dorsal_cortex,mass,maximumdimension,maximumwidth,maximumthickness,techlength,techmaxwidth,techmaxthickness,
techwidthprox,techwidthmes,techwidthdist,techthickprox,techthickmes,techthickdist,
platfwidth,platfthickimpact,platfthickmid,platfthickmax,edgeplatf,angle_height))
comsafrica_data<-read.csv("comsafrica_complete_adjusted.csv",stringsAsFactors=TRUE) %>%
subset(!flake_id == "NONR3495") #filter out this non numbered flake
####################################
# Data cleaning
##################################
# change column names to lower case
colnames(comsafrica_data) <- tolower(colnames(comsafrica_data))
## clean categorical variables
comsafrica_data<-comsafrica_data %>%
mutate(completeness=recode(completeness,
fragment="Indeterminate",
shatter="Indeterminate",
lateral="Indeterminate",
indeterminate="Indeterminate",
Indet="Indeterminate",
other="Indeterminate"),
red_syst=recode(red_syst,Discoidal = "Discoid",idnet = "Indet",inde = "Indet",
Indeterminate = "Indet",other = "Indet",Ind = "Indet",
indet = "Indet",Indet = "Indet",INDET = "Indet",'indeterminate (broken)' = "Indet",
'Indeterminate (broken)' = "Indet",indeterminate = "Indet",laminar = "Laminar",
'Levallois (pref)' = "Levallois",'Lev or Disc' = "Indet",'Levallois indet' = "Levallois",
'Levallois non-Nubian' = "Levallois",'levallois non nubian' = "Levallois",
'LEVALLOIS OR DISCOID' = "Levallois",'LEVALLOIS/LEVALLOIS-RELATED' = "Levallois",
na = "Indet",'NON-LEVALLOIS; ORTHOGONAL VOLUME EXPLOITATION' = "Indet",
none = "Indet",Nubian = "Levallois",'ON ANVIL' = "Bipolar",
'Platform (laminar?)' = "Platform",'Platform / Laminar' = "Platform",
'possible Levallois non-Nubian' = "Levallois",'Other (informal)' = "Indet",
'potential levallois' = "Levallois",levallois = "Levallois",
LEVALLOIS = "Levallois",'Levallois non Nubian' = "Levallois",'Levallois?' = "Levallois",
'potential Lev' = "Levallois",'potential Levallois' = "Levallois",
CENTRIPETAL = "Discoid",discoid = "Discoid",DISCOID = "Discoid",
'Discoid?' = "Discoid",'Core Edge Flake' = "Indet",FLAKE = "Flake",bipolar = "Bipolar"),
red_syst=na_if(red_syst, "Indet"),                                                                    #replace indet by NAs
platform_cortex=recode(platform_cortex, INDET = "Indeterminate",
complete = "Complete", absent = "Absent"),
platform_cortex=na_if(platform_cortex, "Indeterminate"),
flk_form=recode(flk_form,BLADE = "Blade",CONVFLAKE = "Convflake",ELONG = "Blade",
Elong = "Blade",flake = "Flake",FLAKE = "Flake",INDET="Indeterminate"),
flk_form=na_if(flk_form, "Indeterminate"),
directionality=recode(directionality,centripetal = "Centripetal",other = "Other"),
platfmorph=recode(platfmorph,'Chapeau de Gendarme' = "ChapeauDeGendarme",linear = "Linear",
Diherdral = "Dihedral",facetted = "Facetted"),
platflipp=recode_factor(platflipp, YES = "yes", Yes='yes',NO = "no", No="no", 'NOT APPLICABLE' = "Indeterminate"),
platflipp=na_if(platflipp, "Indeterminate"),
bulb=recode(bulb, YES = "yes", Yes="yes",NO = "no",No="no",Indet="Indeterminate"),
bulb=na_if(bulb, "Indeterminate"),
shattbulb=recode(shattbulb,Indet = "Indeterminate",Indeterminateerminate = "Indeterminate",
NO = "No",no="No",YES = "Yes"),
initiation=recode(initiation,BENDING = "Bending",HERTZIAN = "Hertzian",hertzian = "Hertzian",
WEDGING = "Wedging"),
initiation=na_if(initiation, "INDET"),
ventr_plane_form=recode(ventr_plane_form,very_concave = "Very concave",Very_concave = "Very concave",
BULBAR = "Bulbar",CONCAVE = "Concave",FLAT = "Flat",
TWISTED = "Twisted",'VERY CONCAVE' = "Very concave",VERY_CONCAVE = "Very concave"),
section=recode(section,DOMED = "Domed",INDET = "Indeterminate",LENTIC = "Lenticular",
LENTICULAR = "Lenticular",RIGHTTRI = "Righttriangle",RIGHTTRIANGLE = "Righttriangle",FLAT="Lenticular",
TRAP = "Trapezoidal",TRAPEZOIDAL = "Trapezoidal",TRI = "Triangular",TRIANGULAR = "Triangular"),
section=na_if(section, "Indeterminate"),
latedgetype=recode(latedgetype,AMORPH = "Amorphous",CONV = "Convergent",CONVERGENT = "Convergent",SQUARE = "Square",
'SUB-PARALLEL' = "Parallel",DIAMOND = "Diamond",DIV = "Divergent",DIVERGENT = "Divergent",
OVAL = "Ovoid",OVOID = "Ovoid",PARALLEL = "Parallel", INDET = "Indeterminate"),
latedgetype=na_if(latedgetype, "na"),
latedgetype=na_if(latedgetype, "Indeterminate"),
flaketerm=recode(flaketerm,FEATHER = "Feather",HINGE = "Hinge",INDET = "Indeterminate",
OVERSHOT = "Overshot",AXIAL= "Axial",CRUSHED = "Crushed"),
flaketerm=na_if(flaketerm, "Indeterminate"),
kombewa=recode(kombewa,NO = "No",YES = "Yes",no="No", Indet="Indeterminate"),
distplanform=recode(distplanform,FLAT = "Flat",INDET = "Indeterminate",INDETERMINATE = "Indeterminate",CONCAVE="Indeterminate",
IRR = "Irregular",Irreg = "Irregular",POINTED = "Pointed",rounded = "Rounded",ROUNDED = "Rounded"),
distplanform=na_if(distplanform, "Indeterminate"))%>%
map_df(~ na_if(.x, "")) %>%
droplevels
#replacement of NA values by 'Indeterminate' for specific variables where NAs = indet
comsafrica_data$completeness <- fct_explicit_na(comsafrica_data$completeness, na_level = "Indeterminate")
comsafrica_data$kombewa <- fct_explicit_na(comsafrica_data$kombewa, na_level = "Indeterminate")
#summary of qualitative variables + explanations of changes above
summary(comsafrica_data$completeness)# I grouped together other and indeterminate too as it seems that analysts
#used one or the other, but rarely both
summary(comsafrica_data$red_syst)
summary(comsafrica_data$platform_cortex) #indet used for distal fragments as well (as na), so grouped with NAs
summary(comsafrica_data$flk_form) #indet removed, not an option in the E4 file
summary(comsafrica_data$directionality) #indet and other kept as used by same analysts. NAs correspond to when it was not possible to record data (100% cortex) and some human errors
summary(comsafrica_data$platfmorph) #other and indet used by same analysts. Nas correspond to mostly fragments and a few human errors
summary(comsafrica_data$platflipp) #indet exclusively produced by E4 users while NAs correspond to fragments as well as likely indet from non-E4 users (as they are associated with
#a determined platf) --> indet to be removed from the analysis.
summary(comsafrica_data$bulb) #indet are also present when medial fragment so indet is also used as NAs. removed from analysis
summary(comsafrica_data$initiation) #only one INDET, removed from the analysis --> NA
summary(comsafrica_data$ventr_plane_form)
summary(comsafrica_data$section) #flat doesn't exist in E4, grouped with Lenticular; indeterminate can be NA or indet, so replaced by NA
summary(comsafrica_data$latedgetype) #indet is mostly na with a few true indet, so replaced by NA
summary(comsafrica_data$flaketerm) #indet can be both na and indet, so replaced by NA
summary(comsafrica_data$kombewa) #indet are indet and nas are indet with maybe few NAs, I think we can replace NAs by indet.
summary(comsafrica_data$distplanform) #concave does not exist --> indeterminate; indet seems to correspond to NAs (prox or medial fragments?) so grouped with NAs
## cleaning quantitative data##
summary(comsafrica_data$maximumdimension)
comsafrica_data$maximumdimension[comsafrica_data$maximumdimension==0] <- NA
summary(comsafrica_data$mass)
comsafrica_data$mass[comsafrica_data$mass==0] <- NA
summary(comsafrica_data$maximumwidth)
comsafrica_data$maximumwidth[comsafrica_data$maximumwidth==0] <- NA
summary(comsafrica_data$maximumthickness)
comsafrica_data$maximumthickness[comsafrica_data$maximumthickness==0] <- NA
summary(comsafrica_data$techlength)
comsafrica_data$techlength[comsafrica_data$techlength==0] <- NA
summary(comsafrica_data$techmaxwidth)
comsafrica_data$techmaxwidth[comsafrica_data$techmaxwidth==0] <- NA
summary(comsafrica_data$techmaxthickness)
comsafrica_data$techmaxthickness[comsafrica_data$techmaxthickness==0] <- NA
summary(comsafrica_data$techwidthprox)
comsafrica_data$techwidthprox[comsafrica_data$techwidthprox==0] <- NA
summary(comsafrica_data$techwidthmes)
comsafrica_data$techwidthmes[comsafrica_data$techwidthmes==0] <- NA
summary(comsafrica_data$techwidthdist)
comsafrica_data$techwidthdist[comsafrica_data$techwidthdist==0] <- NA
summary(comsafrica_data$techthickprox)
comsafrica_data$techthickprox[comsafrica_data$techthickprox==0] <- NA
summary(comsafrica_data$techthickmes)
comsafrica_data$techthickmes[comsafrica_data$techthickmes==0] <- NA
summary(comsafrica_data$techthickdist)
comsafrica_data$techthickdist[comsafrica_data$techthickdist==0] <- NA
summary(comsafrica_data$platfwidth)
comsafrica_data$platfwidth[comsafrica_data$platfwidth==0] <- NA
summary(comsafrica_data$platfthickmax)
comsafrica_data$platfthickmax[comsafrica_data$platfthickmax==0] <- NA
summary(comsafrica_data$platfthickimpact)
comsafrica_data$platfthickimpact[comsafrica_data$platfthickimpact==0] <- NA
summary(comsafrica_data$platfthickmid)
comsafrica_data$platfthickmid[comsafrica_data$platfthickmid==0] <- NA
summary(comsafrica_data$edgeplatf)
comsafrica_data$edgeplatf[comsafrica_data$edgeplatf==0] <- NA
##Recode flake ID ##
## subset
# renumber flakes to avoid duplicate numbers across technological conditions when running combined IRR analysis
# on all 100 flakes
data.A <- comsafrica_data[which(comsafrica_data$assemblage_code=="chert_condition_A"),]
data.A$new_flake_id <- 0
for(i in 1:length(unique(data.A$flake_id))){
data.A[which(data.A$flake_id==unique(data.A$flake_id)[i]),"new_flake_id"] <- i
}
data.B <- comsafrica_data[which(comsafrica_data$assemblage_code=="chert_condition_B"),]
count = 51
data.B$new_flake_id <- 0
for(i in 1:length(unique(data.B$flake_id))){
data.B[which(data.B$flake_id==unique(data.B$flake_id)[i]),"new_flake_id"] <- count
count = count+1
}
new_comsafrica_data <- rbind(data.A, data.B) %>%
filter(!new_flake_id %in% c(89,97)) #remove two flakes with fragmentation issues
#adjust cortex values to fix data entry errors
#A10 and B25 have strange values because of misinterpretations
#around cortex
new_comsafrica_data$dorsal_cortex[new_comsafrica_data$new_flake_id == 46
& new_comsafrica_data$analyst_id == "46b96"] <- 100
new_comsafrica_data$dorsal_cortex[new_comsafrica_data$new_flake_id == 31
& new_comsafrica_data$analyst_id == "46b96"] <- NA
new_comsafrica_data$dorsal_cortex[new_comsafrica_data$new_flake_id == 23
& new_comsafrica_data$analyst_id == "46b96"] <- 100
new_comsafrica_data$dorsal_cortex[new_comsafrica_data$new_flake_id == 27
& new_comsafrica_data$analyst_id == "46b96"] <- NA
###Corrections duplicates for analyst r42o8
new_comsafrica_data$maximumthickness[new_comsafrica_data$new_flake_id == 11
& new_comsafrica_data$analyst_id == "r42o8"] <- 17.59
new_comsafrica_data$techlength[new_comsafrica_data$new_flake_id == 11
& new_comsafrica_data$analyst_id == "r42o8"] <- 83.46
new_comsafrica_data$techmaxwidth[new_comsafrica_data$new_flake_id == 11
& new_comsafrica_data$analyst_id == "r42o8"] <- 48
new_comsafrica_data$techmaxthickness[new_comsafrica_data$new_flake_id == 11
& new_comsafrica_data$analyst_id == "r42o8"] <- 12.77
new_comsafrica_data$techwidthprox[new_comsafrica_data$new_flake_id == 11
& new_comsafrica_data$analyst_id == "r42o8"] <- NA
new_comsafrica_data$techwidthmes[new_comsafrica_data$new_flake_id == 11
& new_comsafrica_data$analyst_id == "r42o8"] <- NA
new_comsafrica_data$techwidthdist[new_comsafrica_data$new_flake_id == 11
& new_comsafrica_data$analyst_id == "r42o8"] <- NA
new_comsafrica_data$maximumwidth[new_comsafrica_data$new_flake_id == 40
& new_comsafrica_data$analyst_id == "r42o8"] <- 27.05
new_comsafrica_data$maximumthickness[new_comsafrica_data$new_flake_id == 40
& new_comsafrica_data$analyst_id == "r42o8"] <- 7.69
new_comsafrica_data$techlength[new_comsafrica_data$new_flake_id == 40
& new_comsafrica_data$analyst_id == "r42o8"] <- 50.42
new_comsafrica_data$techmaxwidth[new_comsafrica_data$new_flake_id == 40
& new_comsafrica_data$analyst_id == "r42o8"] <- NA
new_comsafrica_data$maximumwidth[new_comsafrica_data$new_flake_id == 85
& new_comsafrica_data$analyst_id == "r42o8"] <- 55.01
new_comsafrica_data$maximumthickness[new_comsafrica_data$new_flake_id == 83
& new_comsafrica_data$analyst_id == "r42o8"] <- 12.59
new_comsafrica_data$techlength[new_comsafrica_data$new_flake_id == 83
& new_comsafrica_data$analyst_id == "r42o8"] <- 51.39
new_comsafrica_data$techmaxwidth[new_comsafrica_data$new_flake_id == 83
& new_comsafrica_data$analyst_id == "r42o8"] <- NA
new_comsafrica_data$maximumwidth[new_comsafrica_data$new_flake_id == 85
& new_comsafrica_data$analyst_id == "r42o8"] <- 19.93
new_comsafrica_data$maximumthickness[new_comsafrica_data$new_flake_id == 85
& new_comsafrica_data$analyst_id == "r42o8"] <- NA
new_comsafrica_data$techwidthprox[new_comsafrica_data$new_flake_id == 41
& new_comsafrica_data$analyst_id == "r42o8"] <- NA
new_comsafrica_data$techwidthdist[new_comsafrica_data$new_flake_id == 70
& new_comsafrica_data$analyst_id == "r42o8"] <- 38.53
new_comsafrica_data$techthickprox[new_comsafrica_data$new_flake_id == 70
& new_comsafrica_data$analyst_id == "r42o8"] <- 16.75
new_comsafrica_data$techthickmes[new_comsafrica_data$new_flake_id == 70
& new_comsafrica_data$analyst_id == "r42o8"] <- 12.55
new_comsafrica_data$techthickdist[new_comsafrica_data$new_flake_id == 70
& new_comsafrica_data$analyst_id == "r42o8"] <- NA
new_comsafrica_data$techwidthmes[new_comsafrica_data$new_flake_id == 33
& new_comsafrica_data$analyst_id == "r42o8"] <- 41.17
new_comsafrica_data$techwidthdist[new_comsafrica_data$new_flake_id == 33
& new_comsafrica_data$analyst_id == "r42o8"] <- 26.43
new_comsafrica_data$techthickprox[new_comsafrica_data$new_flake_id == 33
& new_comsafrica_data$analyst_id == "r42o8"] <- 9.09
new_comsafrica_data$techthickmes[new_comsafrica_data$new_flake_id == 33
& new_comsafrica_data$analyst_id == "r42o8"] <- 7.77
new_comsafrica_data$techthickdist[new_comsafrica_data$new_flake_id == 33
& new_comsafrica_data$analyst_id == "r42o8"] <- 5.34
new_comsafrica_data$platfwidth[new_comsafrica_data$new_flake_id == 33
& new_comsafrica_data$analyst_id == "r42o8"] <- NA
##### Inter rater data analyses
comsafrica_data_complete<-new_comsafrica_data %>%
select(c(assemblage_code,analyst_id,analysis_order,flake_id,new_flake_id,proximal_scars,left_scars,distal_scars,right_scars,
dorsal_cortex,mass,maximumdimension,maximumwidth,maximumthickness,techlength,techmaxwidth,techmaxthickness,
techwidthprox,techwidthmes,techwidthdist,techthickprox,techthickmes,techthickdist,
platfwidth,platfthickimpact,platfthickmid,platfthickmax,edgeplatf,angle_height))
data1 <- comsafrica_data_cat_data
